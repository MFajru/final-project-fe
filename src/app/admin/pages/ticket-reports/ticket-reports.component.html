<div>
  <app-page-header text="Laporan Tiket">
    <app-input-field
      inputType="text"
      inputName="search"
      inputId="search"
      placeholder="Search By Ticket ID"
      errText=""
      inputVariants="iconsRight"
      inputSize="small"
      [fGroup]="form"
      fcName="search"
    />
    <button type="submit" class="hidden"></button>
  </app-page-header>
  <div class="w-full mt-6 flex gap-4">
    @for (item of dropdownComp; track $index) {
    <app-dropdown
      [placeholder]="item.pholder"
      [dropdownItems]="item.items"
      (onDropdownClick)="
        onHandleFilter(item.pholder.split(' ')[2].toLowerCase(), $event)
      "
      (onResetCallback)="
        onResetFilter(item.pholder.split(' ')[2].toLowerCase())
      "
    />
    } @for (item of dateFilter; track $index) {
    <app-input-field
      [inputType]="item.type"
      [inputId]="item.id"
      [inputName]="item.name"
      (onMouseEnter)="
        !item.isDisabled && item.name === 'endDate'
          ? (item.type = 'date')
          : item.name === 'startDate'
          ? (item.type = 'date')
          : (item.type = 'text')
      "
      (clickOutside)="item.type = 'text'"
      inputSize="small"
      [placeholder]="item.placeholder"
      [errText]="item.errText"
      [fcName]="item.fcName"
      [fGroup]="form"
      inputVariants="iconsRight"
      [isDisabled]="item.isDisabled"
      (onReset)="onResetFilter(item.placeholder)"
    />
    }
  </div>
  <div class="mt-1">
    <app-table customClass="lg:w-full">
      <thead>
        <tr class="bg-[#F7F7F7] h-[64px] text-center">
          <td></td>
          @for (tHead of tHeads; track $index) { @if (tHead.isAbleToSort) {
          <td (click)="onClickSort()" class="cursor-pointer">
            <div class="flex items-center justify-start gap-1">
              <p class="text-sm">{{ tHead.title }}</p>
              <lucide-icon
                [name]="dataOrderIcon"
                size="12"
                [strokeWidth]="2.5"
              ></lucide-icon>
            </div>
          </td>
          } @else {
          <td class="text-sm">
            <div class="flex justify-start">
              <p>{{ tHead.title }}</p>
            </div>
          </td>
          } }
        </tr>
      </thead>
      <tbody>
        @for (data of ticketReportsData; ; let idx = $index; track data.id) {
        <tr>
          <th>{{ idx + 1 }}</th>
          <td>{{ data.ticket_number }}</td>
          <td>{{ data.created_at | formatDate : "DD-MM-YYYY" }}</td>
          <td>{{ data.category | toTitleCase }}</td>
          <td>{{ data.division_target }}</td>
          <td>
            <app-ratings [rating]="data.rating" size="small" />
          </td>
          <td>{{ data.time_response }} hari</td>
          <td>
            <app-label-status [status]="data.status" />
          </td>
          <td>
            <div class="flex justify-center items-center gap-[16px]">
              @if (data.status.toLowerCase() === "diajukan") {
              <div class="tooltip" data-tip="Proses tiket">
                <button
                  class="hover:text-orangeStatus"
                  (click)="onHandleUpdateStatus(data.id)"
                >
                  <lucide-icon
                    name="hourglass"
                    size="16"
                    [strokeWidth]="2.5"
                  ></lucide-icon>
                </button>
              </div>
              } @else if (data.status.toLowerCase() === "dalam proses") {
              <div class="tooltip" data-tip="Selesaikan tiket">
                <button
                  class="hover:text-greenStatus"
                  (click)="onHandleUpdateStatus(data.id)"
                >
                  <lucide-icon
                    name="square-check"
                    size="16"
                    [strokeWidth]="2.5"
                  ></lucide-icon>
                </button>
              </div>
              }
              <div class="tooltip" data-tip="Detail">
                <button (click)="router.navigate(['/admin/detail-ticket'])">
                  <lucide-icon
                    name="info"
                    [strokeWidth]="2.5"
                    size="16"
                  ></lucide-icon>
                </button>
              </div>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </app-table>
  </div>
</div>
